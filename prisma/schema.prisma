datasource db {
  provider = "sqlite"
}

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

model User {
  id             Int        @id @default(autoincrement())
  publicId       String     @unique @default(uuid())
  email          String     @unique
  firstName      String
  lastName       String
  image          String?
  status         UserStatus @default(PENDING)
  role           UserRoles  @default(USUARIO)
  isSuperAdmin   Boolean    @default(false)
  isCollaborator Boolean    @default(false)
  createdAt      DateTime   @default(now())
  updatedAt      DateTime   @updatedAt

  accounts     Account[]
  activityLogs AdminActivityLog[]
  permissions UserPermission[]
}

enum UserStatus {
  ACTIVE
  INACTIVE
  PENDING
  BLOCKED
}

enum UserRoles {
  USUARIO
  PROFESSOR
  DESENVOLVEDOR
  ADMINISTRADOR
}

enum AuthProvider {
  CREDENTIALS
  GOOGLE
}

model Account {
  id                Int          @id @default(autoincrement())
  userId            Int
  user              User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  provider          AuthProvider
  providerAccountId String
  password          String?
  accessToken       String?
  refreshToken      String?
  expiresAt         DateTime?
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  @@unique([provider, providerAccountId])
}

model AccountVerificationToken {
  id        String   @id @default(uuid())
  userId    String
  createdAt DateTime @default(now())
  expiresAt DateTime
}

model TextInfo {
  id           Int      @id @default(autoincrement())
  publicId     String   @unique @default(uuid())
  title        String
  isImageOnly  Boolean  @default(false)
  authorName   String
  referenceUrl String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  content TextContent?
  images  Image[]

  genreId Int
  genre   TextualGenre @relation(fields: [genreId], references: [id])
}

model TextContent {
  id         String   @id @default(cuid())
  textInfoId Int      @unique
  textInfo   TextInfo @relation(fields: [textInfoId], references: [id], onDelete: Cascade)
  content    String
}

model Image {
  id         String   @id @default(cuid())
  textInfoId Int
  textInfo   TextInfo @relation(fields: [textInfoId], references: [id], onDelete: Cascade)
  url        String
}

model TextualGenre {
  id          Int        @id @default(autoincrement())
  name        String     @unique
  texts       TextInfo[]
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  creatorName String
  color       String
}

model AdminActivityLog {
  id       Int      @id @default(autoincrement())
  userId   Int
  user     User     @relation(fields: [userId], references: [id])
  action   String
  createdAt DateTime @default(now())
}

model Permission {
  id    Int    @id @default(autoincrement())
  key   String @unique
  users UserPermission[]
}

model UserPermission {
  userId       Int
  permissionId Int

  user       User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  permission Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)

  @@id([userId, permissionId])
}
